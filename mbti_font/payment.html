<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>支付页面 - 多类型测评系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .payment-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            max-width: 500px;
            width: 100%;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .payment-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .payment-header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .payment-header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .payment-body {
            padding: 2rem;
        }

        .order-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .order-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333;
        }

        .order-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .order-details:last-child {
            margin-bottom: 0;
            padding-top: 0.8rem;
            border-top: 1px solid #dee2e6;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .price {
            color: #e74c3c;
            font-weight: bold;
        }

        .payment-methods {
            margin-bottom: 2rem;
        }

        .method-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333;
        }

        .payment-options {
            display: grid;
            gap: 1rem;
        }

        .payment-option {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .payment-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .payment-option.selected {
            border-color: #667eea;
            background: #f8f9ff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .payment-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 1.5rem;
        }

        .wechat-icon {
            background: #07c160;
            color: white;
        }

        .alipay-icon {
            background: #1677ff;
            color: white;
        }

        .payment-info {
            flex: 1;
        }

        .payment-name {
            font-weight: bold;
            margin-bottom: 0.2rem;
        }

        .payment-desc {
            font-size: 0.9rem;
            color: #666;
        }

        .radio-indicator {
            width: 20px;
            height: 20px;
            border: 2px solid #dee2e6;
            border-radius: 50%;
            position: relative;
            transition: all 0.3s ease;
        }

        .payment-option.selected .radio-indicator {
            border-color: #667eea;
        }

        .payment-option.selected .radio-indicator::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: #667eea;
            border-radius: 50%;
        }

        .qr-section {
            text-align: center;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 2rem;
            display: none;
        }

        .qr-section.show {
            display: block;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #ccc;
        }

        .qr-instructions {
            color: #666;
            margin-bottom: 1rem;
        }

        .payment-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: #667eea;
        }

        .status-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            flex: 1;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .security-info {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #155724;
        }

        .countdown {
            text-align: center;
            margin-top: 1rem;
            color: #e74c3c;
            font-weight: bold;
        }

        .success-animation {
            text-align: center;
            padding: 2rem;
            display: none;
        }

        .success-animation.show {
            display: block;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 2rem;
            animation: successPulse 0.6s ease-out;
        }

        @keyframes successPulse {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        .back-link {
            position: absolute;
            top: 2rem;
            left: 2rem;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        .back-link:hover {
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .payment-container {
                max-width: 100%;
            }

            .payment-header {
                padding: 1.5rem;
            }

            .payment-body {
                padding: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .back-link {
                top: 1rem;
                left: 1rem;
            }
        }
    </style>
</head>
<body>
    <a href="javascript:history.back()" class="back-link">
        <i class="fas fa-arrow-left"></i> 返回
    </a>

    <div class="payment-container">
        <!-- 支付头部 -->
        <div class="payment-header">
            <h1><i class="fas fa-credit-card"></i> 安全支付</h1>
            <p>解锁完整测评报告</p>
        </div>

        <!-- 支付主体 -->
        <div class="payment-body">
            <!-- 订单信息 -->
            <div class="order-info">
                <div class="order-title">订单详情</div>
                <div class="order-details">
                    <span>商品名称</span>
                    <span id="productName">MBTI性格测试完整报告</span>
                </div>
                <div class="order-details">
                    <span>订单编号</span>
                    <span id="orderNumber">202401201234567890</span>
                </div>
                <div class="order-details">
                    <span>支付金额</span>
                    <span class="price" id="totalAmount">¥29.90</span>
                </div>
            </div>

            <!-- 支付方式选择 -->
            <div class="payment-methods" id="paymentMethods">
                <div class="method-title">选择支付方式</div>
                <div class="payment-options">
                    <div class="payment-option" data-method="wechat" onclick="selectPaymentMethod('wechat')">
                        <div class="payment-icon wechat-icon">
                            <i class="fab fa-weixin"></i>
                        </div>
                        <div class="payment-info">
                            <div class="payment-name">微信支付</div>
                            <div class="payment-desc">使用微信扫码支付</div>
                        </div>
                        <div class="radio-indicator"></div>
                    </div>
                    <div class="payment-option" data-method="alipay" onclick="selectPaymentMethod('alipay')">
                        <div class="payment-icon alipay-icon">
                            <i class="fab fa-alipay"></i>
                        </div>
                        <div class="payment-info">
                            <div class="payment-name">支付宝</div>
                            <div class="payment-desc">使用支付宝扫码支付</div>
                        </div>
                        <div class="radio-indicator"></div>
                    </div>
                </div>
            </div>

            <!-- 二维码支付区域 -->
            <div class="qr-section" id="qrSection">
                <div class="qr-code" id="qrCode">
                    <i class="fas fa-qrcode"></i>
                </div>
                <div class="qr-instructions" id="qrInstructions">
                    请使用微信扫描上方二维码完成支付
                </div>
                <div class="payment-status">
                    <i class="fas fa-spinner status-spinner"></i>
                    <span>等待支付中...</span>
                </div>
                <div class="countdown" id="countdown">
                    支付剩余时间：<span id="timeLeft">15:00</span>
                </div>
            </div>

            <!-- 支付成功动画 -->
            <div class="success-animation" id="successAnimation">
                <div class="success-icon">
                    <i class="fas fa-check"></i>
                </div>
                <h3>支付成功！</h3>
                <p>正在为您解锁完整报告...</p>
            </div>

            <!-- 操作按钮 -->
            <div class="action-buttons" id="actionButtons">
                <button class="btn btn-secondary" onclick="cancelPayment()">
                    <i class="fas fa-times"></i> 取消支付
                </button>
                <button class="btn btn-primary" id="payButton" onclick="startPayment()" disabled>
                    <i class="fas fa-lock"></i> 立即支付
                </button>
            </div>

            <!-- 安全提示 -->
            <div class="security-info">
                <i class="fas fa-shield-alt"></i>
                <span>您的支付信息受到银行级别的安全保护</span>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let selectedMethod = '';
        let countdownTimer = null;
        let timeLeft = 900; // 15分钟
        let paymentCheckTimer = null;

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializePayment();
        });

        // 初始化支付页面
        function initializePayment() {
            // 从URL参数获取商品信息
            const urlParams = new URLSearchParams(window.location.search);
            const productType = urlParams.get('product') || 'mbti';
            const amount = urlParams.get('amount') || '29.90';
            
            // 更新商品信息
            updateProductInfo(productType, amount);
            
            // 生成订单号
            generateOrderNumber();
        }

        // 更新商品信息
        function updateProductInfo(productType, amount) {
            const productNames = {
                'mbti': 'MBTI性格测试完整报告',
                'holland': '霍兰德职业兴趣完整报告',
                'enneagram': '九型人格测试完整报告',
                'eq': '情商测评完整报告',
                'leadership': '领导力测评完整报告',
                'innovation': '创新思维测评完整报告'
            };
            
            document.getElementById('productName').textContent = productNames[productType] || '测评完整报告';
            document.getElementById('totalAmount').textContent = `¥${amount}`;
        }

        // 生成订单号
        function generateOrderNumber() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            const orderNumber = `${timestamp}${random}`;
            document.getElementById('orderNumber').textContent = orderNumber;
        }

        // 选择支付方式
        function selectPaymentMethod(method) {
            // 移除之前的选中状态
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // 添加新的选中状态
            document.querySelector(`[data-method="${method}"]`).classList.add('selected');
            
            selectedMethod = method;
            
            // 启用支付按钮
            const payButton = document.getElementById('payButton');
            payButton.disabled = false;
            payButton.innerHTML = `<i class="fas fa-lock"></i> 立即支付 ${document.getElementById('totalAmount').textContent}`;
        }

        // 开始支付
        function startPayment() {
            if (!selectedMethod) {
                alert('请选择支付方式');
                return;
            }
            
            // 隐藏支付方式选择
            document.getElementById('paymentMethods').style.display = 'none';
            document.getElementById('actionButtons').style.display = 'none';
            
            // 显示二维码
            showQRCode();
            
            // 开始倒计时
            startCountdown();
            
            // 开始检查支付状态
            startPaymentCheck();
        }

        // 显示二维码
        function showQRCode() {
            const qrSection = document.getElementById('qrSection');
            const qrCode = document.getElementById('qrCode');
            const instructions = document.getElementById('qrInstructions');
            
            qrSection.classList.add('show');
            
            // 模拟生成二维码
            setTimeout(() => {
                qrCode.innerHTML = generateQRCodeHTML();
            }, 500);
            
            // 更新说明文字
            if (selectedMethod === 'wechat') {
                instructions.textContent = '请使用微信扫描上方二维码完成支付';
            } else if (selectedMethod === 'alipay') {
                instructions.textContent = '请使用支付宝扫描上方二维码完成支付';
            }
        }

        // 生成二维码HTML（模拟）
        function generateQRCodeHTML() {
            // 这里应该调用实际的二维码生成API
            return `
                <div style="width: 100%; height: 100%; background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzMzMyIvPgogIDx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+UVIgQ29kZTwvdGV4dD4KICA8L3N2Zz4=') center/cover no-repeat;"></div>
            `;
        }

        // 开始倒计时
        function startCountdown() {
            updateCountdownDisplay();
            
            countdownTimer = setInterval(() => {
                timeLeft--;
                updateCountdownDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(countdownTimer);
                    paymentTimeout();
                }
            }, 1000);
        }

        // 更新倒计时显示
        function updateCountdownDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timeLeftElement = document.getElementById('timeLeft');
            if (timeLeftElement) {
                timeLeftElement.textContent = timeString;
            }
        }

        // 开始检查支付状态
        function startPaymentCheck() {
            // 模拟支付检查，实际应该调用后端API
            paymentCheckTimer = setInterval(() => {
                // 模拟随机支付成功（用于演示）
                if (Math.random() < 0.1) { // 10%概率支付成功
                    paymentSuccess();
                }
            }, 2000);
        }

        // 支付成功
        function paymentSuccess() {
            // 清除定时器
            if (countdownTimer) {
                clearInterval(countdownTimer);
            }
            if (paymentCheckTimer) {
                clearInterval(paymentCheckTimer);
            }
            
            // 隐藏二维码区域
            document.getElementById('qrSection').style.display = 'none';
            
            // 显示成功动画
            document.getElementById('successAnimation').classList.add('show');
            
            // 保存支付状态
            const urlParams = new URLSearchParams(window.location.search);
            const productType = urlParams.get('product') || 'mbti';
            localStorage.setItem(`payment_${productType}`, 'completed');
            
            // 3秒后跳转回结果页面
            setTimeout(() => {
                const resultPages = {
                    'mbti': 'mbti-result.html',
                    'holland': 'holland-result.html',
                    'enneagram': 'enneagram-result.html'
                };
                
                const resultPage = resultPages[productType] || 'assessment-center.html';
                window.location.href = resultPage;
            }, 3000);
        }

        // 支付超时
        function paymentTimeout() {
            // 清除检查定时器
            if (paymentCheckTimer) {
                clearInterval(paymentCheckTimer);
            }
            
            // 显示超时提示
            alert('支付超时，请重新发起支付');
            
            // 重置页面状态
            resetPaymentPage();
        }

        // 取消支付
        function cancelPayment() {
            if (confirm('确定要取消支付吗？')) {
                // 清除所有定时器
                if (countdownTimer) {
                    clearInterval(countdownTimer);
                }
                if (paymentCheckTimer) {
                    clearInterval(paymentCheckTimer);
                }
                
                // 返回上一页
                history.back();
            }
        }

        // 重置支付页面
        function resetPaymentPage() {
            // 重置时间
            timeLeft = 900;
            
            // 隐藏二维码
            document.getElementById('qrSection').classList.remove('show');
            
            // 显示支付方式选择
            document.getElementById('paymentMethods').style.display = 'block';
            document.getElementById('actionButtons').style.display = 'flex';
            
            // 重置选择状态
            selectedMethod = '';
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // 禁用支付按钮
            const payButton = document.getElementById('payButton');
            payButton.disabled = true;
            payButton.innerHTML = '<i class="fas fa-lock"></i> 立即支付';
        }

        // 手动刷新支付状态
        function refreshPaymentStatus() {
            // 模拟检查支付状态
            const button = document.querySelector('.refresh-btn');
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 检查中...';
            
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-sync-alt"></i> 刷新状态';
                
                // 模拟支付成功（演示用）
                if (Math.random() < 0.3) {
                    paymentSuccess();
                }
            }, 2000);
        }

        // 页面卸载时清理定时器
        window.addEventListener('beforeunload', function() {
            if (countdownTimer) {
                clearInterval(countdownTimer);
            }
            if (paymentCheckTimer) {
                clearInterval(paymentCheckTimer);
            }
        });

        // 监听支付宝/微信支付回调（实际项目中需要）
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'payment_result') {
                if (event.data.success) {
                    paymentSuccess();
                } else {
                    alert('支付失败，请重试');
                    resetPaymentPage();
                }
            }
        });
    </script>
</body>
</html>